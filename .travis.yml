language: shell
os: linux
dist: bionic
services:
  - docker

notifications:
  email: false

jobs:
  include:
    - env: SPIGOT_VERSION=latest
    - if: branch = master
      env: SPIGOT_VERSION=1.15.2
    - if: branch = master
      env: SPIGOT_VERSION=1.15.1
    - if: branch = master
      env: SPIGOT_VERSION=1.15
    - if: branch = master
      env: SPIGOT_VERSION=1.14.4
    - if: branch = master
      env: SPIGOT_VERSION=1.14.3
    - if: branch = master
      env: SPIGOT_VERSION=1.14.2
    - if: branch = master
      env: SPIGOT_VERSION=1.14.1
    - if: branch = master
      env: SPIGOT_VERSION=1.14
    - if: branch = master
      env: SPIGOT_VERSION=1.13.2
    - if: branch = master
      env: SPIGOT_VERSION=1.13.1
    - if: branch = master
      env: SPIGOT_VERSION=1.13
    - if: branch = master
      env: SPIGOT_VERSION=1.12.2
    - if: branch = master
      env: SPIGOT_VERSION=1.12.1
    - if: branch = master
      env: SPIGOT_VERSION=1.12
    - if: branch = master
      env: SPIGOT_VERSION=1.11
    - if: branch = master
      env: SPIGOT_VERSION=1.10
    - if: branch = master
      env: SPIGOT_VERSION=1.9.4
    - if: branch = master
      env: SPIGOT_VERSION=1.9.2
    - if: branch = master
      env: SPIGOT_VERSION=1.9
    - if: branch = master
      env: SPIGOT_VERSION=1.8.8
    - if: branch = master
      env: SPIGOT_VERSION=1.8.7
    - if: branch = master
      env: SPIGOT_VERSION=1.8.3
    - if: branch = master
      env: SPIGOT_VERSION=1.8

before_install:
  # Make file executable (Not by default)
  - chmod 755 ./bin/travis-push-to-docker.sh

  # Login to make sure we have access to private dockers
  - |
    if [[ -v DOCKER_PASSWORD && -v DOCKER_USERNAME ]]; then
      echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    fi

script:
  - docker build --build-arg $SPIGOT_VERSION -t spigot .

after_success:
  # Upload the build
  - |
    if [[ -v DOCKER_PASSWORD && -v DOCKER_USERNAME ]]; then
      ./bin/travis-push-to-docker.sh
    fi
